<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ウェルネス・プラットフォーム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Noto+Serif+JP:wght@400;600&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    {/* Firebase v9 compat libraries */}
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>


    <style>
        :root {
            --main-pink: #E9A4B8;
            --support-green: #7A9B7A;
            --bg-off-white: #F8F7F5;
            --text-charcoal: #4E4E4E;
        }
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: var(--bg-off-white);
            color: var(--text-charcoal);
        }
        h1, h2, h3, h4 {
            font-family: 'Noto Serif JP', serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>


    <script type="text/babel">
        // ★★★ 変更点: あなたのFirebase設定を反映 ★★★
        const firebaseConfig = {
          apiKey: "AIzaSyCSK2XMhrPQbZ8J1y-Kz3YCoU45rDKv1bM",
          authDomain: "trauma-note-app.firebaseapp.com",
          projectId: "trauma-note-app",
          storageBucket: "trauma-note-app.appspot.com",
          messagingSenderId: "643740992546",
          appId: "1:643740992546:web:dba603fed8f73b09c9f67b"
        };


        // --- React App ---
        function App() {
            const [user, setUser] = React.useState(null);
            const [loading, setLoading] = React.useState(true);
            const [error, setError] = React.useState('');
            const [email, setEmail] = React.useState('');
            const [password, setPassword] = React.useState('');


            const auth = React.useMemo(() => {
                // Check if Firebase app is already initialized
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                return firebase.auth();
            }, []);


            // ログイン状態を監視
            React.useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((currentUser) => {
                    setUser(currentUser);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, [auth]);


            // --- Authentication Functions ---
            const handleSignUp = async () => {
                setError('');
                try {
                    await auth.createUserWithEmailAndPassword(email, password);
                } catch (err) {
                    setError(`登録に失敗しました: ${err.message}`);
                }
            };
            
            const handleLogin = async () => {
                setError('');
                try {
                    await auth.signInWithEmailAndPassword(email, password);
                } catch (err) {
                    setError(`ログインに失敗しました: ${err.message}`);
                }
            };


            const handleGoogleSignIn = async () => {
                setError('');
                const provider = new firebase.auth.GoogleAuthProvider();
                try {
                    await auth.signInWithPopup(provider);
                } catch (err) {
                    setError(`Googleログインに失敗しました: ${err.message}`);
                }
            };


            const handleLogout = async () => {
                setError('');
                try {
                    await auth.signOut();
                } catch (err) {
                    setError(`ログアウトに失敗しました: ${err.message}`);
                }
            };




            if (loading) {
                return <div className="text-center p-10">読み込み中...</div>;
            }


            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="max-w-md w-full bg-white p-8 rounded-2xl shadow-lg">
                        {user ? (
                            // --- ログイン後のダッシュボード画面 ---
                            <div>
                                <h1 className="text-2xl font-semibold text-center mb-4">ようこそ！</h1>
                                <p className="text-center mb-6 break-all">こんにちは、{user.displayName || user.email}さん</p>
                                <div className="space-y-4">
                                    <button className="w-full bg-gray-100 p-4 rounded-lg text-left hover:bg-gray-200">AI心と体の診断を受ける</button>
                                    <button className="w-full bg-gray-100 p-4 rounded-lg text-left hover:bg-gray-200">トラウマノートを開く</button>
                                    <button className="w-full bg-gray-100 p-4 rounded-lg text-left hover:bg-gray-200">食事と体調を記録する</button>
                                </div>
                                <button 
                                    onClick={handleLogout} 
                                    className="w-full mt-8 py-2 px-4 border border-transparent rounded-full shadow-sm text-sm font-medium text-white"
                                    style={{backgroundColor: 'var(--main-pink)'}}
                                >
                                    ログアウト
                                </button>
                            </div>
                        ) : (
                            // --- ログイン前の画面 ---
                            <div>
                                <h1 className="text-2xl font-semibold text-center mb-6">ログイン</h1>
                                {error && <p className="bg-red-100 text-red-700 p-3 rounded-lg mb-4 text-sm">{error}</p>}
                                <div className="space-y-4">
                                    <div>
                                        <label className="text-sm font-medium">メールアドレス</label>
                                        <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} className="w-full mt-1 p-2 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="text-sm font-medium">パスワード</label>
                                        <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="w-full mt-1 p-2 border rounded-lg" />
                                    </div>
                                    <div className="flex flex-col sm:flex-row gap-2">
                                        <button onClick={handleLogin} className="w-full flex-1 py-2 px-4 border rounded-full font-semibold">ログイン</button>
                                        <button onClick={handleSignUp} className="w-full flex-1 py-2 px-4 border rounded-full font-semibold">新規登録</button>
                                    </div>
                                    <div className="relative my-4">
                                        <div className="absolute inset-0 flex items-center"><div className="w-full border-t border-gray-300"></div></div>
                                        <div className="relative flex justify-center text-sm"><span className="bg-white px-2 text-gray-500">または</span></div>
                                    </div>
                                    <button onClick={handleGoogleSignIn} className="w-full flex items-center justify-center py-2 px-4 border rounded-full font-semibold">
                                        <svg className="w-5 h-5 mr-2" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24s.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></svg>
                                        Googleでログイン
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }


        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>